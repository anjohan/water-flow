include system.in
variable start_temperature equal ${T}
variable highest_temperature equal 4000
variable dt equal ${dt_nowater}
variable heating_time equal 30
variable heating_steps equal ${heating_time}/${dt}
variable thermalising_time equal 20
variable thermalising_steps equal ${thermalising_time}/${dt}
variable cooling_time equal 10
variable cooling_steps equal ${cooling_time}/${dt}
variable thermalising_time_final equal 50
variable thermalising_steps_final equal ${thermalising_time_final}/${dt}
variable total_time equal ${heating_time}+${thermalising_time}+${cooling_time}+${thermalising_time_final}
variable total_steps equal ${total_time}/${dt}
variable total_dumps equal 100
variable dump_frequency equal ${total_steps}/${total_dumps}

log data/log.amorphous
#/atom 1 silicon
#/atom 2 oxygen
#/atom 3 hydrogen
#/bond 1 2 2.6
#/bond 2 3 1.4

#package gpu 2
#suffix gpu

units metal
boundary p p p
atom_style atomic

read_data betacristobalite.data
replicate ${Lx} ${Ly} ${systemheight}

pair_style vashishta
pair_coeff	* * SiO2.vashishta Si O
mass            1 28.08
mass            2 15.9994

neigh_modify every 1 delay 0 check yes
timestep ${dt}

thermo 100
thermo_style custom step time temp press pzz etotal spcpu cpuremain
dump lagring all custom ${dump_frequency} data/amorphous.in.bin id type x y z

velocity all create ${start_temperature} 277385 mom yes loop geom

fix termostat all nvt temp ${start_temperature} ${highest_temperature} 0.1
run ${heating_steps}

fix termostat all nvt temp ${highest_temperature} ${highest_temperature} 1.0
run ${thermalising_steps}

variable thermalising_time equal 10
variable thermalising_steps equal ${thermalising_time}/${dt}

variable cooling_temp index 4000 1900 1400 950 600 375 300

label temploop

variable T1 equal ${cooling_temp}
next cooling_temp
variable T2 equal ${cooling_temp}

fix termostat all nvt temp ${T1} ${T2} 0.1
run ${cooling_steps}
fix termostat all nvt temp ${T2} ${T2} 1.0
run ${thermalising_steps}

if "${cooling_temp} > 301" then "jump SELF temploop"

fix termostat all nvt temp ${T} ${T} 1.0
run ${thermalising_steps_final}

write_data data/amorphous.data
write_restart data/amorphous.restart
